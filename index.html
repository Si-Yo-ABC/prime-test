<!DOCTYPE html>
<html>
<head>
    <title>Dragon Engine Test</title>
    <style>
        body {
            background-color: #0d1117;
            color: #c9d1d9;
            font-family: 'Courier New', Courier, monospace;
            line-height: 1.6;
        }

        .container {
            max-width: 1100px;
            margin: auto;
            padding: 20px;
        }

        .panel {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        h3 {
            color: #58a6ff;
            border-bottom: 1px solid #30363d;
            padding-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        input, select {
            background: #0d1117;
            border: 1px solid #30363d;
            color: #58a6ff;
            padding: 10px;
            border-radius: 4px;
            font-family: inherit;
        }

        .btn-teleport { background: #238636; color: white; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; border-radius: 4px; }
        .btn-ignite { background: #1f6feb; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 4px; }
        .btn-purge { background: #da3633; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; font-size: 0.8em; }

        .prime-card {
            border-left: 4px solid #58a6ff;
            background: #161b22;
            padding: 20px;
            border-radius: 0 6px 6px 0;
        }

        .value {
            font-size: 1.5em;
            color: #79c0ff;
            display: block;
            margin: 10px 0;
            word-wrap: break-word;
        }
    </style>
</head>

<body>

<div class="panel">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h3 style="margin:0;">Dragon Control Unit: Command Tower</h3>
        <div>
            <button onclick="downloadVault()" style="background:#222;color:#00bcff;border:1px solid #00bcff;padding:5px 10px;border-radius:4px;">LOGS</button>
            <button onclick="purgeVault()" class="btn-purge" style="margin-left:5px;">PURGE</button>
        </div>
    </div>

    <p style="color:#888;">[COORDINATES] Starting Prime (p)</p>
    <input type="text" id="manual-p" placeholder="e.g. 104729" style="width:100%;">

    <div style="margin-top:15px;">
        <p style="color:#ff8c00;">[GAPPING] Seed Prime (s)</p>
        <input type="number" id="seed-p" value="2" style="width:100%;">
        <small style="color:#555;">Required for JUMP; ignored for CRAWL.</small>
    </div>

    <p style="color:#888;margin-top:15px;">[ITERATIONS] Loop Count</p>
    <input type="number" id="jump-count" value="1" min="1">

    <div style="margin-top:20px;">
        <button onclick="action('jump')" class="btn-teleport">JUMP (LEAPER)</button>
        <button onclick="action('next')" class="btn-ignite">CRAWL (CRAWLER)</button>
    </div>
</div>

<div class="panel">
    <h3>PREY BOARD (Leaderboard)</h3>
    <div id="results-display"></div>
    <div id="prey-board-list">Loading records...</div>
</div>

<script>
    
    // --- CONFIGURATION ---
        // We know this works because you tested it in the browser!
        //const API_URL = "https://si-yo-abc-prime-generator-api.hf.space/generate";
        //si-yo-abc/prime-generator-api
        const API_URL = "https://si-yo-abc-prime-generator-api.hf.space"; 
        // We split the token so GitHub doesn't "see" it and kill it
        const partA = "hf_"; 
        const partB = "dIhTAgaiHTPBRDcQBHnBzQHbVfttaGkQdI"; // Paste everything AFTER hf_ here

        const TOKEN = partA + partB; 
    // --------------------- 

    async function action(actionType) {
        const pStart = document.getElementById('manual-p').value || "3";
        const sSeed = document.getElementById('seed-p').value || "2";
        const loops = document.getElementById('jump-count').value || 1;
        const display = document.getElementById('results-display');

        if (actionType === "jump" && !sSeed) {
            alert("Seed Prime required for jump.");
            return;
        }

        display.innerHTML = `<p style="color:#ff8c00;">Executing ${actionType.toUpperCase()}...</p>`;

        const params = new URLSearchParams({
            current_p: pStart,
            p_branch: sSeed,
            jumps: loops,
            button_clicked: actionType
        });

        const res = await fetch(`${API_URL}/generate?${params.toString()}`, {
            headers: { Authorization: `Bearer ${TOKEN}` }
        });

        const data = await res.json();

        if (data.status === "success") {
            document.getElementById('manual-p').value = data.new_start_p;

            display.innerHTML = data.history.map(item => `
                <div style="border-left:4px solid #00bcff;padding:10px;margin-bottom:5px;background:#111;">
                    <strong>PRIME FOUND</strong>: ${item.val}<br>
                    <small>Method: ${item.method}</small>
                </div>
            `).join("");

            updateDisplayBoard();
        }
    }

    async function updateDisplayBoard() {
        const res = await fetch(`${API_URL}/display_board`, {
            headers: { Authorization: `Bearer ${TOKEN}` }
        });

        const data = await res.json();
        const list = document.getElementById('prey-board-list');

        if (!data || data.length === 0) {
            list.innerHTML = "<p style='color:#666;'>No records yet.</p>";
            return;
        }

        list.innerHTML = data.map(r => `
            <div style="border-bottom:1px solid #333;padding:8px;display:flex;justify-content:space-between;">
                <span style="color:#00bcff;">${r.value}</span>
                <span>[${r.method}]</span>
                <span style="color:#ff8c00;">${r.beacons} hits</span>
            </div>
        `).join("");
    }

    async function downloadVault() {
        const res = await fetch(`${API_URL}/download_vault`, {
            headers: { Authorization: `Bearer ${TOKEN}` }
        });
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `prime_harvest_${new Date().toISOString().slice(0,10)}.csv`;
        a.click();
        URL.revokeObjectURL(url);
    }

    async function purgeVault() {
        const pw = prompt("Enter purge password:");
        if (!pw) return;
        await fetch(`${API_URL}/purge_memory?password=${pw}`, {
            headers: { Authorization: `Bearer ${TOKEN}` }
        });
        location.reload();
    }

    updateDisplayBoard();
</script>

</body>
</html>
