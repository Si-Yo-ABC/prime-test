<!DOCTYPE html>
<html>
<head>
    <title>Dragon Engine Test</title>
    <style>
        body { background: #0a0a0a; color: #00ff41; font-family: monospace; padding: 20px; }
        .prime-card { border: 1px solid #ff8c00; padding: 20px; border-radius: 10px; background: #111; }
        .value { color: white; word-break: break-all; font-size: 1.2em; }
    </style>
</head>
<body>
<div class="container">
    <div class="panel">
        <button onclick="purgeVault()" class="btn-purge">PURGE VAULT</button>
        <button onclick="downloadVault()" class="btn-download">DOWNLOAD LOGS</button>
        <h3>Dragon Control Unit: Command Tower</h3>
        
        <div style="margin-bottom: 20px;">
            <p style="color:#888;">[MICROSCOPE] Target Specific Prime or Exponent</p>
            <input type="text" id="manual-p" placeholder="Enter Prime Number">
            <button onclick="action('teleport')" class="btn-teleport">JUMP (TELEPORT)</button>
            <button onclick="action('generate')" class="btn-ignite">CRAWL (SCOUT)</button>
        </div>

        <div>
            <p style="color:#888;">[TELESCOPE] Target Digit Magnitude (e.g., 2500000000)</p>
            <input type="number" id="digit-size" placeholder="Enter Digit Size">
            <button onclick="huntMassive()" class="btn-ignite" style="background:#ff00ff;">GENERATE MASSIVE</button>
        </div>
    </div>

    <div id="results-display"></div>
    
    <div class="panel" id="prey-board-container">
        <h3>PREY BOARD (Leaderboard)</h3>
        <div id="prey-board-list">Loading records...</div>
    </div>
</div>



    <script>
        // --- CONFIGURATION ---
            // We know this works because you tested it in the browser!
            //const API_URL = "https://si-yo-abc-prime-generator-api.hf.space/generate";
            //si-yo-abc/prime-generator-api
            const API_URL = "https://si-yo-abc-prime-generator-api.hf.space"; 
            // We split the token so GitHub doesn't "see" it and kill it
            const partA = "hf_"; 
            const partB = "dIhTAgaiHTPBRDcQBHnBzQHbVfttaGkQdI"; // Paste everything AFTER hf_ here
    
            const TOKEN = partA + partB; 
        // ---------------------
    let currentLeader = "";

    async function action(type) {
        const p = document.getElementById('manual-p').value || currentLeader;
        const display = document.getElementById('results-display');
        display.innerHTML = `<h2 style="color: #ff8c00">Dragon is ${type === 'teleport' ? 'Teleporting' : 'Scouting'} from ${p}...</h2>`;

        try {
            const endpoint = type === 'teleport' ? `/teleport?p=${p}` : `/generate?p=${p}`;
            const response = await fetch(`${API_URL}${endpoint}`, {
                method: 'GET',
                headers: { 'Authorization': `Bearer ${TOKEN}` }
            });
            const data = await response.json();

            if (data.prime || data.leader) {
                const prime = data.prime || data.leader;
                currentLeader = prime;
                document.getElementById('manual-p').value = prime;
                
                display.innerHTML = `
                    <div class="prime-card">
                        <h2 style="color: #00bcff">TARGET NEUTRALIZED (100% PURE)</h2>
                        <span class="value">${prime}</span>
                        <div class="stat-grid">
                            <div class="stat-item"><span class="stat-label">FIND TIME</span>${data.find_time || data.time}s</div>
                            <div class="stat-item"><span class="stat-label">CERTIFY TIME</span>${data.certify_time || 'N/A'}s</div>
                            <div class="stat-item"><span class="stat-label">BEACONS EVADED</span>${data.beacons_evaded || data.landings || 0}</div>
                            <div class="stat-item"><span class="stat-label">METHOD</span>${type.toUpperCase()}</div>
                        </div>
                    </div>`;
                updatePreyBoard();
            }
        } catch (err) {
            display.innerHTML = `<p style="color:red">Engine Stall: ${err.message}</p>`;
        }
    }

    async function updatePreyBoard() {
        try {
            const res = await fetch(`${API_URL}/prey_board`, {
                headers: { 'Authorization': `Bearer ${TOKEN}` }
            });
            const data = await res.json();
            const list = document.getElementById('prey-board-list');
            list.innerHTML = data.map(r => `
                <div style="border-bottom:1px solid #333; padding:5px; font-size:0.9em;">
                    [${r.find}s] Prime: ${r.value.substring(0,20)}... | Beacons: ${r.beacons}
                </div>
            `).join('');
        } catch (e) { console.error("Prey Board Offline"); }
    } 

        // --- 1. Download Vault(solving the mystery) ---
        async function downloadVault() {
        
            try {
                const cleanUrl = API_URL.endsWith('/') ? API_URL.slice(0, -1) : API_URL;
                const res = await fetch(`${cleanUrl}/download_vault`, {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${TOKEN}` } // Same as your Purge!
                });
        
                if (!res.ok) {
                    alert("ðŸ›‘ Access Denied: Invalid Password or Token.");
                    return;
                }
        
                // Convert the response to a Blob (the file data)
                const blob = await res.blob();
                
                // Create a temporary link to trigger the download
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Dragon_Flight_Log_${new Date().getTime()}.csv`;
                document.body.appendChild(a);
                a.click();
                
                // Cleanup
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
        
            } catch (err) {
                console.error("Vault Error:", err);
                alert("Failed to reach the Vault.");
            }
        }
    
        // --- 2. THE PURGE (CLEAN SLATE) ---
        async function purgeVault() {
            const pw = prompt("Enter Dragon Command Password to Wipe Database:");
            if (!pw) return;
    
            try {
                // Added a safety check to make sure API_URL doesn't end in a slash
                const cleanUrl = API_URL.endsWith('/') ? API_URL.slice(0, -1) : API_URL;
                const res = await fetch(`${cleanUrl}/purge_memory?password=${pw}`, {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${TOKEN}` }
                });
                // If the response is HTML (404 page), this will throw the error we saw
                if (!res.ok) throw new Error(`HTTP Error: ${res.status}`);
                const data = await res.json();
                alert(data.status);
                currentLeader = "1";
                location.reload(); // Refresh to show the empty vault
            } catch (e) {
                alert("Purge Failed: Engine Offline.");
            }
        }
    
        async function huntNext() {
            document.getElementById('next-btn').style.display = "none";
            await ignite(currentLeader);
        }

        // Initialize board on load
    updatePreyBoard();
    </script>
</body>
</html>
