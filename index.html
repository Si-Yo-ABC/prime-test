<!DOCTYPE html>
<html>
<head>
    <title>Dragon Engine Test</title>
    <style>
        body { background: #0a0a0a; color: #00ff41; font-family: monospace; padding: 20px; }
        .prime-card { border: 1px solid #ff8c00; padding: 20px; border-radius: 10px; background: #111; }
        .value { color: white; word-break: break-all; font-size: 1.2em; }
    </style>
</head>
<body>
<div class="research-controls" style="background:#111; padding:20px; border: 1px solid #444; border-radius:10px;">
    <h3 style="color:#ff8c00; margin-top:0;">DRAGON CONTROL UNIT</h3>
    <input type="number" id="manual-p" placeholder="Enter Starting Prime" style="background:#000; color:#00ff41; border:1px solid #00ff41; padding:10px;">
    <button onclick="ignite(document.getElementById('manual-p').value)" style="background:#00ff41; color:#000; padding:10px 20px; border:none; cursor:pointer; font-weight:bold;">IGNITE ENGINE</button>
    
    <button onclick="purgeVault()" style="background:#440000; color:#ff0000; border:1px solid #ff0000; padding:10px; float:right; cursor:pointer;">PURGE ALL DATA</button>
</div>
<div id="leaderboard"></div>
<div id="vault-display" style="display:flex; gap:20px; margin-top:20px;">
    <div style="flex:2; background:#000; border:1px solid #00ff41; height:400px; overflow-y:auto;">
        <table style="width:100%; text-align:left; font-size:0.8em;">
            <thead style="position:sticky; top:0; background:#222;">
                <tr><th>Prime</th><th>2^p-e</th><th>3^p-e</th><th>Hunt Time</th></tr>
            </thead>
            <tbody id="prime-body"></tbody>
        </table>
    </div>
    
    <div style="flex:1; background:#000; border:1px solid #ff8c00; height:400px; overflow-y:auto;">
        <table style="width:100%; text-align:left; font-size:0.8em;">
            <thead style="position:sticky; top:0; background:#222;">
                <tr><th>Shift Marker (Mine)</th><th>Origin</th></tr>
            </thead>
            <tbody id="shift-body"></tbody>
        </table>
    </div>
</div>

    <script>
        // --- CONFIGURATION ---
            // We know this works because you tested it in the browser!
            const API_URL = "https://si-yo-abc-prime-generator-api.hf.space/generate"; 
            // We split the token so GitHub doesn't "see" it and kill it
            const partA = "hf_"; 
            const partB = "dIhTAgaiHTPBRDcQBHnBzQHbVfttaGkQdI"; // Paste everything AFTER hf_ here
    
            const TOKEN = partA + partB; 
        // ---------------------
    
        let currentLeader = "1"; 
    
        // --- 1. THE RADAR (REFRESH DISPLAY) ---
        async function refreshDisplay() {
            try {
                // Sends currentLeader so Radar shows what is NEXT
                const res = await fetch(`${BASE_URL}/view_dna?current_p=${currentLeader}`);
                const data = await res.json();
                
                const pBody = document.getElementById('prime-body');
                const sBody = document.getElementById('shift-body');
    
                if (pBody && data.primes) {
                    // Now displays the new Research Columns: Value, Time, 2^p, 3^p
                    pBody.innerHTML = data.primes.map(p => 
                        `<tr>
                            <td><strong>${p[0]}</strong></td>
                            <td>${parseFloat(p[1]).toFixed(6)}s</td>
                            <td style="color:#00bcff">${p[2] || '-'}</td>
                            <td style="color:#bc00ff">${p[3] || '-'}</td>
                        </tr>`
                    ).join('');
                }
                
                if (sBody && data.shifts) {
                    sBody.innerHTML = data.shifts.map(s => 
                        `<tr><td>${s[0]}</td><td style="color:#ff8c00">${s[1]}</td></tr>`
                    ).join('');
                }
            } catch (e) {
                console.error("Radar Sync Error:", e);
            }
        }
    
        // --- 2. THE PURGE (CLEAN SLATE) ---
        async function purgeVault() {
            const pw = prompt("Enter Dragon Command Password to Wipe Database:");
            if (!pw) return;
    
            try {
                const res = await fetch(`${BASE_URL}/purge_memory?password=${pw}`);
                const data = await res.json();
                alert(data.status);
                currentLeader = "1";
                location.reload(); // Refresh to show the empty vault
            } catch (e) {
                alert("Purge Failed: Engine Offline.");
            }
        }
    
        // --- 3. THE IGNITION (GENERATE) ---
        async function ignite(p) {
            if (!p) p = currentLeader;
            const display = document.getElementById('leaderboard');
            display.innerHTML = `<h2 style="color: #ff8c00">Dragon is hunting from ${p}...</h2>`;
    
            try {
                const response = await fetch(`${API_URL}?p=${p}`, {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${TOKEN}` }
                });
                const data = await response.json();
    
                if (data.leader) {
                    currentLeader = data.leader;
                    const note = data.note === "Vault Hit" ? " (VAULT HIT)" : "";
                    
                    display.innerHTML = `
                        <div class="prime-card" style="border-color: #00ff41">
                            <h2 style="color: #00ff41">100% PURE PRIME FOUND${note}</h2>
                            <p><strong>LEADER:</strong> <span class="value">${data.leader}</span></p>
                            <hr>
                            <p><strong>LANDING GEAR SHIFTS:</strong> ${data.landings || 0}</p>
                            <p><strong>HUNT TIME:</strong> ${data.time}s</p>
                        </div>`;
                    
                    document.getElementById('next-btn').style.display = "inline-block";
                    document.getElementById('manual-p').value = data.leader;
                }
                refreshDisplay();
            } catch (err) {
                display.innerHTML = `<p style="color:red">Engine Stall: ${err.message}</p>`;
            }
        }
    
        async function huntNext() {
            document.getElementById('next-btn').style.display = "none";
            await ignite(currentLeader);
        }
    
        // Initial Load
        refreshDisplay();
    </script>
</body>
</html>
