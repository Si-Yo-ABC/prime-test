<!DOCTYPE html>
<html>
<head>
    <title>Dragon Engine Test</title>
    <style>
        body { background: #0a0a0a; color: #00ff41; font-family: monospace; padding: 20px; }
        .prime-card { border: 1px solid #ff8c00; padding: 20px; border-radius: 10px; background: #111; }
        .value { color: white; word-break: break-all; font-size: 1.2em; }
    </style>
</head>
<body>
    <h1>The Succession of the Spark</h1>
    <div style="text-align: center; margin: 20px 0;">
        <button id="next-btn" onclick="huntNext()" style="padding: 15px 30px; background: #ff8c00; color: #000; font-weight: bold; cursor: pointer; border: none; border-radius: 5px; display: none;">
            üî• HUNT NEXT PRIME
        </button>
    </div>
    <div id="leaderboard"></div>
    <div style="display: flex; gap: 20px; margin-top: 20px;">
        <div style="flex: 1; border: 1px solid #00ff00; border-radius: 5px; background: #000;">
            <h4 style="text-align: center; color: #00ff00;">üíé FOUND LEADERS</h4>
            <div id="prime-scroll" style="height: 200px; overflow-y: auto; padding: 10px; font-size: 0.9em;">
                <table style="width: 100%; color: #00ff00;">
                    <thead><tr><th>Value</th><th>Time (s)</th></tr></thead>
                    <tbody id="prime-body"></tbody>
                </table>
            </div>
        </div>

        <div style="flex: 1; border: 1px solid #00ff00; border-radius: 5px; background: #000;">
            <h4 style="text-align: center; color: #00ff00;">üõ°Ô∏è DNA MARKERS (SHIFTS)</h4>
            <div id="shift-scroll" style="height: 200px; overflow-y: auto; padding: 10px; font-size: 0.9em;">
                <table style="width: 100%; color: #00ff00;">
                    <thead><tr><th>Marker (x¬≤)</th><th>Parent (x)</th></tr></thead>
                    <tbody id="shift-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        // We know this works because you tested it in the browser!
        const API_URL = "https://si-yo-abc-prime-generator-api.hf.space/generate"; 
        // We split the token so GitHub doesn't "see" it and kill it
        const partA = "hf_"; 
        const partB = "dIhTAgaiHTPBRDcQBHnBzQHbVfttaGkQdI"; // Paste everything AFTER hf_ here

        const TOKEN = partA + partB; 
        // ---------------------
        let currentLeader = "1"; // Global tracker

        async function refreshDisplay() {
    try {
        // We pass the currentLeader so the DB shows us what's coming up NEXT
        const res = await fetch(`${BASE_URL}/view_dna?current_p=${currentLeader}`);
        const data = await res.json();
        
        const pBody = document.getElementById('prime-body');
        const sBody = document.getElementById('shift-body');

        if (pBody && data.primes) {
            pBody.innerHTML = data.primes.map(p => 
                `<tr><td>${p[0]}</td><td>${parseFloat(p[1]).toFixed(6)}s</td></tr>`
            ).join('');
        }
        
        if (sBody && data.shifts) {
            // This will now show shifts like 9, 25, 49... 
            // instead of jumping straight to 3481!
            sBody.innerHTML = data.shifts.map(s => 
                `<tr><td>${s[0]}</td><td>${s[1]}</td></tr>`
            ).join('');
        }
    } catch (e) {
        console.error("Radar Error:", e);
    }
}

        async function huntNext() {
    // Hide the button so you don't double-click while it's thinking
    document.getElementById('next-btn').style.display = "none";
    await ignite(currentLeader);
}

async function ignite(p = "1") {
    const display = document.getElementById('leaderboard');
    display.innerHTML = `<h2 style="color: #ff8c00">Dragon is hunting from ${p}...</h2>`;

    try {
        const response = await fetch(`${API_URL}?p=${p}`, {
            method: 'GET',
            headers: { 'Authorization': `Bearer ${TOKEN}` }
        });
        const data = await response.json();

        if (data.leader) {
            currentLeader = data.leader; // Feed the global tracker
            const purityColor = data.pure_prime ? "#00ff41" : "#ff0000";
            
            display.innerHTML = `
                <div class="prime-card" style="border-color: ${purityColor}">
                    <h2 style="color: ${purityColor}">100% PURE PRIME FOUND</h2>
                    <p><strong>LEADER:</strong> <span class="value" id="current-p">${data.leader}</span></p>
                    <hr>
                    <p><strong>LANDING GEAR SHIFTS:</strong> ${data.landings}</p>
                    <p><strong>HUNT TIME:</strong> ${data.time}s</p>
                </div>`;
            
            // Show the "Next" button for the next jump
            document.getElementById('next-btn').style.display = "inline-block";
        }

        refreshDisplay();
    } catch (err) {
        display.innerHTML = `<p style="color:red">Engine Stall: ${err.message}</p>`;
        document.getElementById('next-btn').style.display = "inline-block";
    }
}
        // ACTUALLY RUN THE FUNCTION
    ignite();
    </script>
</body>
</html>
